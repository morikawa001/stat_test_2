<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç—‡ä¾‹æ•°è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn {
            padding: 10px 20px;
            background: #e9ecef;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
            min-width: 120px;
        }
        .tab-btn.active {
            background: #3498db;
            color: white;
        }
        .panel { display: none; }
        .panel.active { display: block; animation: fadeIn 0.3s; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button.calc-btn {
            width: 100%;
            padding: 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        button.calc-btn:hover { background: #219150; }
        #result-area {
            margin-top: 30px;
            padding: 20px;
            background: #e8f6f3;
            border-left: 5px solid #1abc9c;
            border-radius: 4px;
            display: none;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“Š ç—‡ä¾‹æ•°è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('mean')">å¹³å‡å€¤ã®å·®</button>
        <button class="tab-btn" onclick="switchTab('prop')">å‰²åˆã®å·®</button>
        <button class="tab-btn" onclick="switchTab('paired')">å¯¾å¿œã®ã‚ã‚‹å¹³å‡</button>
        <button class="tab-btn" onclick="switchTab('corr')">ç›¸é–¢ä¿‚æ•°</button>
    </div>

    <!-- 1. å¹³å‡å€¤ã®å·® (tæ¤œå®š) -->
    <div id="mean" class="panel active">
        <div class="form-group">
            <label>ç¾¤1ã®å¹³å‡å€¤ (Mean 1)</label>
            <input type="number" id="m1" value="10" step="0.1">
        </div>
        <div class="form-group">
            <label>ç¾¤2ã®å¹³å‡å€¤ (Mean 2)</label>
            <input type="number" id="m2" value="12" step="0.1">
        </div>
        <div class="form-group">
            <label>å…±é€šæ¨™æº–åå·® (SD)</label>
            <input type="number" id="sd" value="3" step="0.1">
        </div>
        <div class="form-group">
            <label>å‰²ã‚Šå½“ã¦æ¯” (ç¾¤1:ç¾¤2 = 1:k)</label>
            <input type="number" id="ratio" value="1" min="0.1" step="0.1">
            <small>â€» 1ã‚’å…¥åŠ›ã™ã‚‹ã¨1:1ã€2ã‚’å…¥åŠ›ã™ã‚‹ã¨1:2ã«ãªã‚Šã¾ã™</small>
        </div>
        
        <!-- å…±é€šè¨­å®š -->
        <div class="form-group">
            <label>æœ‰æ„æ°´æº– (Î±)</label>
            <select id="alpha_mean">
                <option value="0.05">0.05 (5%)</option>
                <option value="0.01">0.01 (1%)</option>
                <option value="0.10">0.10 (10%)</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ¤œå‡ºåŠ› (1-Î²)</label>
            <select id="power_mean">
                <option value="0.80">0.80 (80%)</option>
                <option value="0.90">0.90 (90%)</option>
                <option value="0.95">0.95 (95%)</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ¤œå®šå´ (Sides)</label>
            <select id="side_mean">
                <option value="two">ä¸¡å´æ¤œå®š (Two-sided)</option>
                <option value="one">ç‰‡å´æ¤œå®š (One-sided)</option>
            </select>
        </div>
        <button class="calc-btn" onclick="calcMean()">è¨ˆç®—ã™ã‚‹</button>
    </div>

    <!-- 2. å‰²åˆã®å·® -->
    <div id="prop" class="panel">
        <div class="form-group">
            <label>ç¾¤1ã®å‰²åˆ (P1) [0.0 ~ 1.0]</label>
            <input type="number" id="p1" value="0.3" step="0.01" max="1">
        </div>
        <div class="form-group">
            <label>ç¾¤2ã®å‰²åˆ (P2) [0.0 ~ 1.0]</label>
            <input type="number" id="p2" value="0.5" step="0.01" max="1">
        </div>
        
        <div class="form-group">
            <label>æœ‰æ„æ°´æº– (Î±)</label>
            <select id="alpha_prop">
                <option value="0.05">0.05 (5%)</option>
                <option value="0.01">0.01 (1%)</option>
                <option value="0.10">0.10 (10%)</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ¤œå‡ºåŠ› (1-Î²)</label>
            <select id="power_prop">
                <option value="0.80">0.80 (80%)</option>
                <option value="0.90">0.90 (90%)</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ¤œå®šå´</label>
            <select id="side_prop">
                <option value="two">ä¸¡å´æ¤œå®š</option>
                <option value="one">ç‰‡å´æ¤œå®š</option>
            </select>
        </div>
        <button class="calc-btn" onclick="calcProp()">è¨ˆç®—ã™ã‚‹</button>
    </div>

    <!-- 3. å¯¾å¿œã®ã‚ã‚‹å¹³å‡ -->
    <div id="paired" class="panel">
        <div class="form-group">
            <label>å¤‰åŒ–é‡ã®å¹³å‡ (Mean Difference)</label>
            <input type="number" id="md" value="2.0" step="0.1">
        </div>
        <div class="form-group">
            <label>å¤‰åŒ–é‡ã®æ¨™æº–åå·® (SD of Difference)</label>
            <input type="number" id="sdd" value="3.0" step="0.1">
        </div>
        
        <div class="form-group">
            <label>æœ‰æ„æ°´æº– (Î±)</label>
            <select id="alpha_paired">
                <option value="0.05">0.05 (5%)</option>
                <option value="0.01">0.01 (1%)</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ¤œå‡ºåŠ› (1-Î²)</label>
            <select id="power_paired">
                <option value="0.80">0.80 (80%)</option>
                <option value="0.90">0.90 (90%)</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ¤œå®šå´</label>
            <select id="side_paired">
                <option value="two">ä¸¡å´æ¤œå®š</option>
                <option value="one">ç‰‡å´æ¤œå®š</option>
            </select>
        </div>
        <button class="calc-btn" onclick="calcPaired()">è¨ˆç®—ã™ã‚‹</button>
    </div>

    <!-- 4. ç›¸é–¢ä¿‚æ•° -->
    <div id="corr" class="panel">
        <div class="form-group">
            <label>æƒ³å®šã™ã‚‹ç›¸é–¢ä¿‚æ•° (r)</label>
            <input type="number" id="r_val" value="0.4" step="0.05" max="1" min="-1">
        </div>
        
        <div class="form-group">
            <label>æœ‰æ„æ°´æº– (Î±)</label>
            <select id="alpha_corr">
                <option value="0.05">0.05 (5%)</option>
                <option value="0.01">0.01 (1%)</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ¤œå‡ºåŠ› (1-Î²)</label>
            <select id="power_corr">
                <option value="0.80">0.80 (80%)</option>
                <option value="0.90">0.90 (90%)</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ¤œå®šå´</label>
            <select id="side_corr">
                <option value="two">ä¸¡å´æ¤œå®š</option>
                <option value="one">ç‰‡å´æ¤œå®š</option>
            </select>
        </div>
        <button class="calc-btn" onclick="calcCorr()">è¨ˆç®—ã™ã‚‹</button>
    </div>

    <div id="result-area">
        <h3>è¨ˆç®—çµæœ</h3>
        <p id="result-text"></p>
    </div>
</div>

<script>
    // Zå€¤ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–‡å­—åˆ—ã‚­ãƒ¼ã‚’ä½¿ç”¨ï¼‰
    const Z_TABLE = {
        '0.05_two': 1.96, '0.05_one': 1.645,
        '0.01_two': 2.576, '0.01_one': 2.326,
        '0.10_two': 1.645, '0.10_one': 1.282,
        '0.80': 0.842, '0.90': 1.282, '0.95': 1.645
    };

    function switchTab(id) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
        document.getElementById('result-area').style.display = 'none';
    }

    function getZ(alphaStr, side) {
        return Z_TABLE[alphaStr + '_' + side];
    }
    function getZB(powerStr) {
        return Z_TABLE[powerStr];
    }

    function showResult(html) {
        const area = document.getElementById('result-area');
        area.style.display = 'block';
        document.getElementById('result-text').innerHTML = html;
        area.scrollIntoView({behavior: 'smooth'});
    }

    // 1. å¹³å‡å€¤ã®å·®
    function calcMean() {
        const m1 = parseFloat(document.getElementById('m1').value);
        const m2 = parseFloat(document.getElementById('m2').value);
        const sd = parseFloat(document.getElementById('sd').value);
        const k = parseFloat(document.getElementById('ratio').value);
        const alpha = document.getElementById('alpha_mean').value; // æ–‡å­—åˆ—ã®ã¾ã¾å–å¾—
        const power = document.getElementById('power_mean').value; // æ–‡å­—åˆ—ã®ã¾ã¾å–å¾—
        const side = document.getElementById('side_mean').value;

        const delta = Math.abs(m1 - m2);
        if(delta === 0) { alert('å¹³å‡å€¤ã«å·®ãŒã‚ã‚Šã¾ã›ã‚“'); return; }

        const za = getZ(alpha, side);
        const zb = getZB(power);

        // å¼: n1 = (Za+Zb)^2 * SD^2 * (1 + 1/k) / delta^2
        const num = Math.pow(za + zb, 2) * Math.pow(sd, 2) * (1 + 1/k);
        const den = Math.pow(delta, 2);
        
        const n1 = Math.ceil(num / den);
        const n2 = Math.ceil(n1 * k);
        const total = n1 + n2;

        showResult(`
            <strong>ç¾¤1 (n1):</strong> ${n1} å<br>
            <strong>ç¾¤2 (n2):</strong> ${n2} å<br>
            <hr style="margin:10px 0; border:0; border-top:1px solid #ccc;">
            <strong>åˆè¨ˆ (Total):</strong> <span style="font-size:1.2em; color:#d35400;">${total} å</span><br>
            <small>(ãƒ‰ãƒ­ãƒƒãƒ—ã‚¢ã‚¦ãƒˆ10%è€ƒæ…®: ${Math.ceil(total * 1.1)} å)</small>
        `);
    }

    // 2. å‰²åˆã®å·®
    function calcProp() {
        const p1 = parseFloat(document.getElementById('p1').value);
        const p2 = parseFloat(document.getElementById('p2').value);
        const alpha = document.getElementById('alpha_prop').value;
        const power = document.getElementById('power_prop').value;
        const side = document.getElementById('side_prop').value;

        if(p1 === p2) { alert('å‰²åˆã«å·®ãŒã‚ã‚Šã¾ã›ã‚“'); return; }

        const za = getZ(alpha, side);
        const zb = getZB(power);
        const p_bar = (p1 + p2) / 2;
        const diff = Math.abs(p1 - p2);

        // è¿‘ä¼¼å¼
        const term1 = za * Math.sqrt(2 * p_bar * (1 - p_bar));
        const term2 = zb * Math.sqrt(p1 * (1 - p1) + p2 * (1 - p2));
        const n_one_group = Math.ceil(Math.pow(term1 + term2, 2) / Math.pow(diff, 2));
        
        const total = n_one_group * 2;

        showResult(`
            <strong>å„ç¾¤ (n):</strong> ${n_one_group} å<br>
            <hr style="margin:10px 0; border:0; border-top:1px solid #ccc;">
            <strong>åˆè¨ˆ (Total):</strong> <span style="font-size:1.2em; color:#d35400;">${total} å</span><br>
            <small>(ãƒ‰ãƒ­ãƒƒãƒ—ã‚¢ã‚¦ãƒˆ10%è€ƒæ…®: ${Math.ceil(total * 1.1)} å)</small>
        `);
    }

    // 3. å¯¾å¿œã®ã‚ã‚‹å¹³å‡
    function calcPaired() {
        const md = parseFloat(document.getElementById('md').value);
        const sdd = parseFloat(document.getElementById('sdd').value);
        const alpha = document.getElementById('alpha_paired').value;
        const power = document.getElementById('power_paired').value;
        const side = document.getElementById('side_paired').value;

        if(md === 0) { alert('å¤‰åŒ–é‡ãŒ0ã§ã™'); return; }

        const za = getZ(alpha, side);
        const zb = getZB(power);
        
        // å¼: n = (Za+Zb)^2 * SDd^2 / Md^2
        const n = Math.ceil( Math.pow(za + zb, 2) * Math.pow(sdd, 2) / Math.pow(md, 2) );

        showResult(`
            <strong>å¿…è¦ãƒšã‚¢æ•°:</strong> <span style="font-size:1.2em; color:#d35400;">${n} çµ„</span><br>
            <small>(ãƒ‰ãƒ­ãƒƒãƒ—ã‚¢ã‚¦ãƒˆ10%è€ƒæ…®: ${Math.ceil(n * 1.1)} çµ„)</small>
        `);
    }

    // 4. ç›¸é–¢ä¿‚æ•°
    function calcCorr() {
        const r = parseFloat(document.getElementById('r_val').value);
        const alpha = document.getElementById('alpha_corr').value;
        const power = document.getElementById('power_corr').value;
        const side = document.getElementById('side_corr').value;

        if(r === 0) { alert('ç›¸é–¢ä¿‚æ•°0ã«å¯¾ã™ã‚‹æ¤œå®šã¯ç‰¹æ®Šã§ã™'); return; }

        const za = getZ(alpha, side);
        const zb = getZB(power);
        
        // Fisher's Zå¤‰æ›: Zr = 0.5 * ln((1+r)/(1-r))
        const zr = 0.5 * Math.log((1 + r) / (1 - r));
        
        // å¼: n = ((Za+Zb)/Zr)^2 + 3
        const n = Math.ceil( Math.pow((za + zb) / Math.abs(zr), 2) + 3 );

        showResult(`
            <strong>å¿…è¦ç—‡ä¾‹æ•°:</strong> <span style="font-size:1.2em; color:#d35400;">${n} å</span><br>
            <small>(ãƒ‰ãƒ­ãƒƒãƒ—ã‚¢ã‚¦ãƒˆ10%è€ƒæ…®: ${Math.ceil(n * 1.1)} å)</small>
        `);
    }
</script>

</body>
</html>
